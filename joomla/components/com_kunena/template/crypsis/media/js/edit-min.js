var previewActive=false;function kPreviewHelper(a){if(a==true){if(jQuery("#kbbcode-message").val()!=null){jQuery.ajax({type:"POST",url:jQuery("#kpreview_url").val(),async:false,dataType:"json",data:{body:jQuery("#kbbcode-message").val()},success:function(b){jQuery("#kbbcode-preview").html(b.preview);}});}}}jQuery(document).ready(function(){if(jQuery("#kemojis_allowed").val()){var a="";if(jQuery("#kbbcode-message").length>0){a="#kbbcode-message";}else{if(jQuery(".qreply").length>0){a=".qreply";}}if(a!=undefined){jQuery(a).atwho({at:":",tpl:"<li data-value='${key}'>${name} <img src='${url}' height='20' width='20' /></li>",callbacks:{remote_filter:function(b,c){if(b.length>0){jQuery.ajax({url:jQuery("#kurl_emojis").val(),data:{search:b},success:function(d){c(d.emojis);}});}}}});}}jQuery("#kbutton-preview").click(function(){var d=jQuery("#kbbcode-preview");var c=jQuery("#kbbcode-message");if(d.length>0){if(!d.is(":visible")){d.css("display","block");c.css("width","95%");previewActive=true;kPreviewHelper(previewActive);}else{previewActive=false;d.css("display","none");c.css("width","95%");}d.attr("class","kbbcode-preview-bottom controls");var b=c.css("height");d.css("height",c.css("height"));}});jQuery("#kbbcode-message").bind("input propertychange",function(){kPreviewHelper(previewActive);});if(jQuery.fn.sisyphus!=undefined){jQuery("#postform").sisyphus({locationBased:true,timeout:5});}jQuery("#kshow_attach_form").click(function(){if(jQuery("#kattach_form").is(":visible")){jQuery("#kattach_form").hide();}else{jQuery("#kattach_form").show();}});jQuery("#postcatid").change(function(){var b=jQuery("#kurl_topicons_request").val();jQuery.ajax({type:"POST",url:b,async:false,dataType:"json",data:{catid:jQuery("select#postcatid option").filter(":selected").val()},success:function(d){jQuery("#iconset_topic_list").remove();var c=jQuery("<div>",{id:"iconset_topic_list"});jQuery("#iconset_inject").append(c);jQuery.each(d,function(g,h){if(h.type!="system"){if(h.id==0){var e=jQuery("<input>",{type:"radio",id:"radio"+h.id,checked:"checked",name:"topic_emoticon",value:h.id});}else{var e=jQuery("<input>",{type:"radio",id:"radio"+h.id,name:"topic_emoticon",value:h.id});}var i=jQuery("<span>",{"class":"kiconsel"}).append(e);var f=jQuery("<label>",{"class":"radio inline","for":h.id}).append(jQuery("<img>",{src:h.path,border:"0",al:""}));i.append(f);jQuery("#iconset_topic_list").append(i);}});}});});});